<div class="patient-list-container">
  <div class="page-header">
    <div>
      <h1 class="page-title">Pacientes</h1>
      <p class="page-description">Gestiona la información de tus pacientes</p>
    </div>
    <app-button variant="primary" [routerLink]="['/patients/new']">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M12 4v16m8-8H4" stroke-width="2" stroke-linecap="round"/>
      </svg>
      Nuevo Paciente
    </app-button>
  </div>

  <app-card padding="lg">
    <div class="filters-section">
      <div class="search-box">
        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <input
          type="text"
          class="search-input"
          placeholder="Buscar por nombre, documento, email o teléfono..."
          [(ngModel)]="searchQuery"
          (keyup.enter)="onSearch()"
        />
        @if (searchQuery()) {
          <button class="clear-button" (click)="searchQuery.set(''); onSearch()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M6 18L18 6M6 6l12 12" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        }
      </div>

      <div class="filter-group">
        <label class="filter-label">Estado:</label>
        <select 
          class="filter-select"
          [(ngModel)]="statusFilter"
          (change)="onStatusFilterChange()"
        >
          <option value="all">Todos</option>
          <option value="active">Activos</option>
          <option value="inactive">Inactivos</option>
          <option value="archived">Archivados</option>
        </select>
      </div>
    </div>

    @if (loading()) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Cargando pacientes...</p>
      </div>
    } @else if (error()) {
      <div class="error-state">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <p>{{ error() }}</p>
        <app-button variant="outline" (clicked)="loadPatients()">Reintentar</app-button>
      </div>
    } @else if (patients().length === 0) {
      <div class="empty-state">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <h3>No se encontraron pacientes</h3>
        <p>Comienza agregando tu primer paciente</p>
        <app-button variant="primary" [routerLink]="['/patients/new']">Agregar Paciente</app-button>
      </div>
    } @else {
      <div class="patients-grid">
        @for (patient of patients(); track patient.id) {
          <div class="patient-card" [routerLink]="['/patients', patient.id]">
            <div class="patient-header">
              <div class="patient-avatar">
                {{ patient.firstName.charAt(0) }}{{ patient.lastName.charAt(0) }}
              </div>
              <div class="patient-info">
                <h3 class="patient-name">{{ patient.firstName }} {{ patient.lastName }}</h3>
                <p class="patient-document">{{ patient.documentType }}: {{ patient.documentNumber }}</p>
              </div>
              <span class="status-badge" [class]="getStatusBadgeClass(patient.status)">
                {{ getStatusLabel(patient.status) }}
              </span>
            </div>
            <div class="patient-details">
              <div class="detail-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>{{ getAge(patient.dateOfBirth) }} años</span>
              </div>
              <div class="detail-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>{{ patient.primaryPhone }}</span>
              </div>
              @if (patient.email) {
                <div class="detail-item">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  <span>{{ patient.email }}</span>
                </div>
              }
            </div>
          </div>
        }
      </div>

      @if (meta()) {
        <div class="pagination">
          <div class="pagination-info">
            Mostrando {{ (currentPage() - 1) * pageSize() + 1 }} - 
            {{ Math.min(currentPage() * pageSize(), meta()!.total) }} de {{ meta()!.total }} pacientes
          </div>
          <div class="pagination-controls">
            <button
              class="pagination-button"
              [disabled]="currentPage() === 1"
              (click)="onPageChange(currentPage() - 1)"
            >
              Anterior
            </button>
            @for (page of [].constructor(meta()!.totalPages); track $index) {
              <button
                class="pagination-button"
                [class.active]="$index + 1 === currentPage()"
                (click)="onPageChange($index + 1)"
              >
                {{ $index + 1 }}
              </button>
            }
            <button
              class="pagination-button"
              [disabled]="currentPage() === meta()!.totalPages"
              (click)="onPageChange(currentPage() + 1)"
            >
              Siguiente
            </button>
          </div>
        </div>
      }
    }
  </app-card>
</div>
